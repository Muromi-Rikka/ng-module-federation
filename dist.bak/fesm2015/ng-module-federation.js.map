{"version":3,"file":"ng-module-federation.js","sources":["../../../projects/library/src/lib/module-federation.ts","../../../projects/library/src/lib/micro-frontend.ts","../../../projects/library/src/public-api.ts","../../../projects/library/src/ng-module-federation.ts"],"sourcesContent":["type Scope = unknown;\ntype Factory = () => any;\n\ntype Container = {\n  init(shareScope: Scope): Promise<void>;\n  get(module: string): Promise<Factory>;\n};\n\ndeclare const __webpack_init_sharing__: (shareScope: string) => Promise<void>;\ndeclare const __webpack_share_scopes__: { default: Scope };\n\nconst moduleMap = { };\nconst remoteMap = { };\nlet isDefaultScopeInitialized = false;\n\nexport function loadRemoteEntry(remoteEntry: string, remoteName: string): Promise<void> {\n  return new Promise<void>((resolve, reject) => {\n    // Is remoteEntry already loaded?\n    if (moduleMap[remoteEntry]) {\n      resolve();\n\n      return;\n    }\n\n    const script = document.createElement('script');\n\n    script.src = remoteEntry;\n    script.onerror = reject;\n\n    script.onload = () => {\n      initRemote(remoteName);\n      moduleMap[remoteEntry] = true;\n      resolve();\n    };\n\n    document.body.append(script);\n  });\n}\n\nexport async function initRemote(remoteName: string): Promise<Container> {\n  const container = window[remoteName] as Container;\n\n  // Do we still need to initialize the remote?\n  if (remoteMap[remoteName]) {\n    return;\n  }\n\n  // Do we still need to initialize the share scope?\n  if (!isDefaultScopeInitialized) {\n    await __webpack_init_sharing__('default');\n    isDefaultScopeInitialized = true;\n  }\n\n  await container.init(__webpack_share_scopes__.default);\n  remoteMap[remoteName] = true;\n\n  return container;\n}\n\nexport async function lookupExposedModule<T>(remoteName: string, exposedModule: string): Promise<T> {\n  const container = window[remoteName] as Container;\n  const factory = await container.get(exposedModule);\n  const Module = factory();\n\n  return Module as T;\n}\n","import { Route } from '@angular/router';\n\nimport { lookupExposedModule } from './module-federation';\n\nexport class MicroFrontend {\n  public constructor(\n    public remoteEntry: string,\n    public remoteName: string,\n    public route: string,\n    public ngModuleName: string,\n    public exposedModule = './Module',\n  ) { }\n}\n\nexport async function loadMicroFrontend<T = any>(microFrontend: MicroFrontend): Promise<T> {\n  return lookupExposedModule<T>(microFrontend.remoteName, microFrontend.exposedModule);\n}\n\nexport function createMicroFrontendRoute(path: string, microFrontend: MicroFrontend): Route {\n  return {\n    loadChildren: () => loadMicroFrontend(microFrontend),\n    path,\n  };\n}\n\nexport function createMicroFrontendDynamicRoute(microFrontend: MicroFrontend): Route {\n  return createMicroFrontendRoute(microFrontend.route, microFrontend);\n}\n","/*\n * Public API Surface of library\n */\n\nexport * from './lib/module-federation';\nexport * from './lib/micro-frontend';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":";;AAWA,MAAM,SAAS,GAAG,EAAG,CAAC;AACtB,MAAM,SAAS,GAAG,EAAG,CAAC;AACtB,IAAI,yBAAyB,GAAG,KAAK,CAAC;SAEtB,eAAe,CAAC,WAAmB,EAAE,UAAkB;IACrE,OAAO,IAAI,OAAO,CAAO,CAAC,OAAO,EAAE,MAAM;;QAEvC,IAAI,SAAS,CAAC,WAAW,CAAC,EAAE;YAC1B,OAAO,EAAE,CAAC;YAEV,OAAO;SACR;QAED,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAEhD,MAAM,CAAC,GAAG,GAAG,WAAW,CAAC;QACzB,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC;QAExB,MAAM,CAAC,MAAM,GAAG;YACd,UAAU,CAAC,UAAU,CAAC,CAAC;YACvB,SAAS,CAAC,WAAW,CAAC,GAAG,IAAI,CAAC;YAC9B,OAAO,EAAE,CAAC;SACX,CAAC;QAEF,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;KAC9B,CAAC,CAAC;AACL,CAAC;SAEqB,UAAU,CAAC,UAAkB;;QACjD,MAAM,SAAS,GAAG,MAAM,CAAC,UAAU,CAAc,CAAC;;QAGlD,IAAI,SAAS,CAAC,UAAU,CAAC,EAAE;YACzB,OAAO;SACR;;QAGD,IAAI,CAAC,yBAAyB,EAAE;YAC9B,MAAM,wBAAwB,CAAC,SAAS,CAAC,CAAC;YAC1C,yBAAyB,GAAG,IAAI,CAAC;SAClC;QAED,MAAM,SAAS,CAAC,IAAI,CAAC,wBAAwB,CAAC,OAAO,CAAC,CAAC;QACvD,SAAS,CAAC,UAAU,CAAC,GAAG,IAAI,CAAC;QAE7B,OAAO,SAAS,CAAC;KAClB;CAAA;SAEqB,mBAAmB,CAAI,UAAkB,EAAE,aAAqB;;QACpF,MAAM,SAAS,GAAG,MAAM,CAAC,UAAU,CAAc,CAAC;QAClD,MAAM,OAAO,GAAG,MAAM,SAAS,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;QACnD,MAAM,MAAM,GAAG,OAAO,EAAE,CAAC;QAEzB,OAAO,MAAW,CAAC;KACpB;;;MC7DY,aAAa;IACxB,YACS,WAAmB,EACnB,UAAkB,EAClB,KAAa,EACb,YAAoB,EACpB,gBAAgB,UAAU;QAJ1B,gBAAW,GAAX,WAAW,CAAQ;QACnB,eAAU,GAAV,UAAU,CAAQ;QAClB,UAAK,GAAL,KAAK,CAAQ;QACb,iBAAY,GAAZ,YAAY,CAAQ;QACpB,kBAAa,GAAb,aAAa,CAAa;KAC9B;CACN;SAEqB,iBAAiB,CAAU,aAA4B;;QAC3E,OAAO,mBAAmB,CAAI,aAAa,CAAC,UAAU,EAAE,aAAa,CAAC,aAAa,CAAC,CAAC;KACtF;CAAA;SAEe,wBAAwB,CAAC,IAAY,EAAE,aAA4B;IACjF,OAAO;QACL,YAAY,EAAE,MAAM,iBAAiB,CAAC,aAAa,CAAC;QACpD,IAAI;KACL,CAAC;AACJ,CAAC;SAEe,+BAA+B,CAAC,aAA4B;IAC1E,OAAO,wBAAwB,CAAC,aAAa,CAAC,KAAK,EAAE,aAAa,CAAC,CAAC;AACtE;;AC3BA;;;;ACAA;;;;;;"}